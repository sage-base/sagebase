---
allowed-tools: Read, Glob, Grep, Edit, Write, Bash, AskUserQuestion, mcp__serena__find_file, mcp__serena__find_symbol, mcp__serena__get_symbols_overview, mcp__serena__list_dir, mcp__serena__list_memories, mcp__serena__read_memory, mcp__serena__search_for_pattern, mcp__serena__think_about_collected_information, mcp__serena__think_about_task_adherence, mcp__serena__think_about_whether_you_are_done
description: セッションで発見した課題をCLAUDE.mdやSKILLに反映するPRを作成するコマンド
---
ultrathink

# セッション振り返り＆改善PRワークフロー

## 目的

このセッションで発生した「手直し」「修正指示」「見落とし」「繰り返しミス」などの課題を分析し、
二度と同じ問題が起きないようにCLAUDE.mdやSKILLファイルに改善を反映するPRを作成します。

---

## Phase 1: セッションの課題分析

### 1.1 会話履歴の振り返り

このセッション全体の会話を振り返り、以下のパターンを特定してください：

**特定すべきパターン:**
1. **手戻り・修正指示**: ユーザーが「ここ直して」「これ違う」と指摘した箇所
2. **繰り返しミス**: 同じ種類のミスが複数回発生した箇所
3. **見落とし**: ユーザーに言われるまで気づかなかった規約やパターン
4. **暗黙の前提**: ドキュメントに明文化されていないが守るべきだったルール
5. **非効率な作業**: もっと効率的にできたはずの作業フロー

### 1.2 課題の分類

特定した課題を以下のカテゴリに分類してください：

| カテゴリ | 反映先 | 例 |
|---------|-------|-----|
| プロジェクト全体のルール | CLAUDE.md | コーディング規約の追記、注意事項の追加 |
| 特定タスクのガイドライン | 既存SKILL更新 | チェックリスト項目の追加、ガイドライン修正 |
| 新しいタスク種別のルール | 新規SKILL作成 | 新しい作業パターンのSKILL化 |
| ハードガードレールで防げる | CI/hook改善 | 自動チェック可能なルール（※PRには含めず提案のみ） |

**重要**: ハードガードレール（CI、Pre-commit hooks）で防げる課題はSKILLに書かず、別途CI改善のIssueとして提案してください。

### 1.3 課題リストの提示

ユーザーに発見した課題リストを提示し、以下を確認してください：

- 他にも反映すべき課題はあるか？
- 優先度の高い課題はどれか？
- 反映先（CLAUDE.md / SKILL / 新規SKILL）は適切か？

---

## Phase 2: 改善内容の設計

### 2.1 既存ドキュメントの確認

改善対象のファイルを読み込み、現在の内容を把握します：

- `CLAUDE.md` の該当セクション
- 関連するSKILLファイル（`.claude/skills/*/SKILL.md`）
- 必要に応じて `reference.md` や `examples.md`

### 2.2 改善案の作成

各課題に対して具体的な改善案を作成してください：

**改善案のフォーマット:**
```
### 課題: [課題の説明]
- 発生状況: [どのような状況で発生したか]
- 根本原因: [なぜ発生したか]
- 改善内容: [何をどう変更するか]
- 反映先: [CLAUDE.md / SKILL名 / 新規SKILL名]
```

### 2.3 設計原則の確認

改善案が以下の原則に従っているか確認してください：

- [ ] ハードガードレールで担保できる内容を含んでいない
- [ ] 用途が絞られている（広範囲すぎない）
- [ ] 具体的で実用的なガイダンスになっている
- [ ] 既存のSKILLと重複していない
- [ ] 「良い例」と「悪い例」を対比させている（可能な場合）

---

## Phase 3: 改善の実装

### 3.1 ブランチの作成

```
git checkout -b improve/session-learnings-YYYYMMDD
```

日付部分は実際の日付に置き換えてください。

### 3.2 ファイルの編集

課題リストに基づいて、以下のファイルを編集してください：

1. **CLAUDE.md**: プロジェクト全体に関わるルールの追記・修正
2. **既存SKILL**: チェックリスト項目やガイドラインの追加・修正
3. **新規SKILL**: 必要に応じて新しいSKILLを作成（skill-creatorの原則に従う）

**編集時の注意:**
- 最小限の変更に留める（関係ない箇所は触らない）
- 既存の構造・スタイルに合わせる
- 追加する内容は具体的かつ簡潔に

### 3.3 コード品質チェック

マークダウンファイルのみの変更の場合でも、リンク切れなどがないか確認してください。

---

## Phase 4: PRの作成

### 4.1 変更内容の確認

!git status
!git diff

### 4.2 コミット

変更をコミットしてください。コミットメッセージは以下の形式で：

```
セッション振り返り: [主な改善内容の要約]
```

### 4.3 PRの作成

以下の形式でPRを作成してください：

```
タイトル: セッション振り返り: CLAUDE.md/SKILL改善

本文:
## 概要
セッション中に発見した課題を基に、CLAUDE.mdおよびSKILLファイルを改善しました。

## 発見した課題
- [課題1の概要]
- [課題2の概要]
- ...

## 変更内容
- [ファイル1]: [変更内容]
- [ファイル2]: [変更内容]
- ...

## 今後の対応が必要な項目（ハードガードレール化の提案など）
- [提案1]
- [提案2]
```

---

## 注意事項

- **ユーザーとの対話を重視**: 課題リストは必ずユーザーに確認を取ってから実装に進む
- **最小限の変更**: 必要以上にファイルを変更しない
- **具体性**: 抽象的なルールではなく、具体的なガイドラインを追加する
- **SKILL設計原則の遵守**: `.claude/skills/skill-design-principles/SKILL.md` の原則に従う
- **CI改善は別途Issue**: ハードガードレールで防げる課題は、PRではなくIssue作成を提案する
